sudo: required

language: minimal

# Avoid double build on PRs (See https://github.com/travis-ci/travis-ci/issues/1147)
branches:
  only:
    - main

services:
  - docker

env:
  - RELEASES=2.3.1
  - RELEASES=2.3.1-ubi
  - RELEASES=3.1.2
  - RELEASES=3.1.2-ubi
  - RELEASES=3.2.0
  - RELEASES=3.2.1
  - RELEASES=3.2.2
  - RELEASES=3.3.0
  - RELEASES=3.3.1

# Needs updating for fdb
#  - RELEASES=dev
#  - RELEASES=dev-cluster

script:
  - for rel in $RELEASES; do docker build -t couchdb:$rel $rel; docker run -d --name $rel -e COUCHDB_USER=admin -e COUCHDB_PASSWORD=password -p 5984:5984 couchdb:$rel && sleep 10 && curl http://admin:password@localhost:5984/ && docker kill $rel; done
